<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Photon Blitz Score System</title>
  
  <!-- PWA metadata -->
  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#00eaff" />
  <link rel="apple-touch-icon" href="photonblitzlogo.png" />

  <!-- Register service worker for offline support -->
  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('service-worker.js')
        .then(() => console.log('Service Worker Registered'));
    }
  </script>

  <!-- Styling -->
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@500&display=swap');

    /* General reset and theme */
    * { box-sizing: border-box; }

    body {
      font-family: 'Orbitron', sans-serif;
      background: linear-gradient(to bottom right, #010518, #012B58);
      color: #00eaff;
      margin: 0;
      padding: 20px;
      text-align: center;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .logo {
      max-width: 300px;
      margin: 0 auto 20px;
      display: block;
    }

    /* Main scoreboard container */
    .scoreboard {
  width: calc(100% - 20px); /* shrink width to allow for side padding */
  padding: 20px 10px; /* top/bottom 20px, left/right 10px */
  margin: 0 auto 20px auto;
  border: 3px solid #00ffff;
  border-radius: 15px;
  box-shadow: 0 0 15px #00ffff, 0 0 30px #00ffff inset;
  display: flex;
  flex-direction: row;
  justify-content: space-around;
  align-items: center;
  position: relative;
  height: 180px;
}

    .score-side {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 5px;
    }

    .score-center {
  position: relative;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: space-between;
  height: 100%;
  width: 220px;
  padding: 10px 0;
  gap: 5px;
  box-sizing: border-box;
}

    .score-name {
      font-size: 1.4em;
      text-shadow: 0 0 5px #0ff;
    }

    .score-number {
      font-size: 5em;
      font-weight: bold;
      text-shadow: 0 0 3px #0ff, 0 0 5px #0ff;
    }

    #logoWrapper {
  position: absolute;
  top: -20px; /* üëà push it near the top of .score-center */
  left: 50%;
  transform: translateX(-50%);
  display: flex;
  justify-content: center;
  align-items: center;
  visibility: visible;
  opacity: 1;
  transition: opacity 0.3s ease, visibility 0.3s ease;
  animation: flash 1s infinite;
}

#logoWrapper.hidden {
  visibility: hidden;
  opacity: 0;
}

    #mainLogo {
      height: 60px;
      filter: drop-shadow(0 0 6px #00eaff);
    }

    #blitzWrapper {
  display: flex;
  align-items: center;
  gap: 10px;
  visibility: hidden;
  opacity: 0;
  transition: opacity 0.3s ease, visibility 0.3s ease;
  animation: flash 1s infinite;
}

#blitzWrapper.active {
  visibility: visible;
  opacity: 1;
}

    #blitzLogo {
      height: 40px;
      filter: drop-shadow(0 0 6px #ffcc00);
    }

    #blitzBanner {
      font-size: 1.8em;
      font-weight: bold;
      color: #ffcc00;
      text-shadow: 0 0 4px #ffcc00;
    }

    @keyframes flash {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.3; }
    }

    /* Timer display */
    #timer {
  font-size: clamp(4.5em, 6vw, 5.5em);
  margin-bottom: 10px;
  color: #ff4444;
  text-shadow: 0 0 10px #f00, 0 0 20px #f00;
  max-width: 100%;
  word-wrap: break-word;
  overflow-wrap: break-word;
  white-space: normal;
  height: 1.2em; /* üëà locks height to prevent shifting */
  display: flex;
  align-items: center;
  justify-content: center;
}

    .names {
      display: flex;
      justify-content: center;
      gap: 30px;
      font-size: 1.5em;
      text-shadow: 0 0 5px #0ff, 0 0 10px #0ff;
    }

    .scores {
      margin-top: 10px;
      font-size: 5em;
      font-weight: bold;
      text-shadow: 0 0 3px #0ff, 0 0 5px #0ff;
    }

    .timeout-button button {
  font-size: 1.8em;
  padding: 14px 30px;
  background: #00eaff;
  color: #012B58;
  font-weight: bold;
  border: none;
  border-radius: 10px;
  box-shadow: 0 0 12px #00eaff80;
  cursor: pointer;
  margin-bottom: 20px;
}

    /* Button layout */
    .buttons {
      display: flex;
      justify-content: center;
      flex-wrap: nowrap;
      gap: 20px;
      overflow-x: auto;
      padding: 10px;
      scroll-behavior: smooth;
    }

    /* Button styling */
    .buttons button,
    .time-controls button {
      flex: 0 0 auto;
      font-size: 1.2em;
      padding: 10px 18px;
      margin: 5px;
      border: none;
      border-radius: 8px;
      background: #00eaff;
      color: #012B58;
      font-weight: bold;
      cursor: pointer;
      box-shadow: 0 0 10px #00eaff80;
      white-space: nowrap;
    }

    #gear {
      display: block;
      margin: 30px auto 10px auto;
      font-size: 2.5em;
      cursor: pointer;
    }

    /* Settings menu */
    #menu {
      opacity: 0;
      transition: opacity 0.5s ease;
      pointer-events: none;
      margin-top: 30px;
      width: 100%;
      max-width: 500px;
      padding: 20px;
      background: rgba(1, 5, 24, 0.9);
      border: 2px solid #00ffff;
      border-radius: 10px;
      box-sizing: border-box;
    }

    #menu.active {
      opacity: 1;
      pointer-events: all;
    }

    .name-container {
      display: flex;
      justify-content: center;
      gap: 20px;
      flex-wrap: wrap;
      margin-top: 10px;
    }

    .name-input {
      font-size: 1.4em;
      padding: 10px;
      border: none;
      border-radius: 5px;
      font-family: 'Orbitron', sans-serif;
      text-align: center;
      min-width: 150px;
      flex: 1 1 40%;
    }

    .match-summary {
      margin-top: 20px;
      font-size: 1.2em;
      text-shadow: 0 0 5px #0ff;
    }

    .winner {
      color: #00ff00;
      font-weight: bold;
    }

    .time-controls {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      margin: 20px auto;
      gap: 10px;
    }

    /* Locked mode tweaks (when scoreboard is fixed to top) */
    body.locked .logo {
      display: none;
    }

    body.locked {
  padding-top: 360px;
  overflow-x: hidden;
  scroll-padding-top: 360px; /* ensures in-page links don‚Äôt go behind the scoreboard */
}

body.locked #scrollSpacer {
  height: 360px; /* same as padding-top so nothing scrolls under the scoreboard */
}

    body.locked .scoreboard {
      position: fixed;
      top: 10px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 999;
    }

    body.locked #menu {
      margin-top: 200px;
    }

    #menu {
      max-height: 70vh;
      overflow-y: auto;
    }

    @media (max-width: 500px) {
      #timer { font-size: 4em; }
      .names { font-size: 1.2em; gap: 15px; }
      .scores { font-size: 3.5em; }
      .buttons { gap: 10px; padding: 5px; }
      .buttons button { font-size: 0.9em; padding: 6px 10px; max-width: 100px; }
      .time-controls button { font-size: 0.9em; padding: 6px 10px; }
      .name-container { flex-direction: column; align-items: center; gap: 10px; }
      .name-input { width: 90%; max-width: 300px; }
    }

    @media (max-width: 360px) {
      #timer {
    font-size: 3.2em;
    max-width: 100%;
    white-space: normal;
    word-wrap: break-word;
    overflow-wrap: break-word;
  }
      .buttons { justify-content: flex-start; }
    }
    #scoreboardMask {
    display: none;
  }

body.locked #scoreboardMask {
  display: block;
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 200px; /* Match or slightly exceed .scoreboard height + spacing */
  background: linear-gradient(to bottom right, #010518, #012B58);
  z-index: 998;
  pointer-events: none;
}
    body.locked #scoreboardMask::after {
  content: "";
  position: absolute;
  bottom: 0;
  left: 0;
  height: 20px;
  width: 100%;
  background: linear-gradient(to bottom, rgba(1,5,24,1), rgba(1,5,24,0));
}
    #gearBack {
  display: none;
}

#menu.active #gearBack {
  display: block;
}
    .timer-small {
  font-size: 3em !important;
  text-shadow: 0 0 6px #f00;
}
    .menu-action {
  font-size: 1.2em;
  padding: 10px 18px;
  margin: 5px;
  border: none;
  border-radius: 8px;
  background: #00eaff;
  color: #012B58;
  font-weight: bold;
  cursor: pointer;
  box-shadow: 0 0 10px #00eaff80;
  white-space: nowrap;
}
    #timer.running {
  color: #00ff00;
  text-shadow: 0 0 10px #0f0, 0 0 20px #0f0;
}
   #rotatePrompt {
    display: none;
    position: fixed;
    top: 0; left: 0;
    width: 100vw; height: 100vh;
    background: #000000f0;
    color: white;
    font-size: 1.8em;
    justify-content: center;
    align-items: center;
    text-align: center;
    padding: 20px;
    z-index: 9999;
  }
    /* Ensure controls are always below the scoreboard */
#buttonsWrapper,
.timeout-button {
  margin-top: 20px; /* Adjust if needed, scoreboard height is 180px */
}

body.locked #buttonsWrapper,
body.locked .timeout-button {
  margin-top: 20px; /* Matches body's padding-top when locked */
}
    #versionTag {
  margin-top: -10px;
  margin-bottom: 10px;
  font-size: 0.9em;
  color: #00eaffa0;
  text-shadow: 0 0 5px #00eaff40;
}
    button, input[type="button"], input[type="submit"] {
  touch-action: manipulation;
}
    .score-name {
  font-size: 1.4em;
  text-shadow: 0 0 5px #0ff;
  letter-spacing: 0.25em;
}
    .compact-summary {
  font-size: 1em;
  color: #00eaffcc;
  text-shadow: 0 0 4px #00eaff;
  padding: 0 10px;
  max-width: 100%;
  word-break: break-word;
}
    /* Ensure spacing below scoreboard when locked and in landscape */
@media screen and (orientation: landscape) {
  body.locked .scoreboard {
    margin-bottom: 220px; /* Enough space for controls to render cleanly */
  }

  #buttonsWrapper,
  .timeout-button {
    margin-top: 40px; /* Additional spacing in landscape */
  }
}
    .scoreboard.reverse {
  flex-direction: row-reverse;
}
  </style>
</head>
<body>
  <div id="scoreboardMask"></div>
  <!-- App logo: visible at top unless scoreboard is locked -->
  
  <div class="scoreboard">
    <div class="score-side">
      <div id="homeDisplay" class="score-name">Player 1</div>
      <div id="homeScoreDisplay" class="score-number">0</div>
    </div>
  
    <div class="score-center">
      <div id="logoWrapper">
        <img src="photonblitzlogo.png" id="mainLogo" alt="Photon Logo" />
      </div>
      <div id="blitzWrapper">
  <img src="photonblitzlogo.png" id="blitzLogo" alt="Photon Logo" onclick="startTimeout()" />
  <div id="blitzBanner" onclick="startTimeout()">BLITZ ‚ö°</div>
</div>
            <div id="compactSummary" class="compact-summary"></div>
            <div id="timer">3:00.0</div>
    </div>

    <div class="score-side">
      <div id="awayDisplay" class="score-name">Player 2</div>
      <div id="awayScoreDisplay" class="score-number">0</div>
    </div>
  </div>
  
<div id="scrollSpacer"></div>
  
  <div id="rotatePrompt">Please rotate your device to landscape mode.</div>
  <!-- Timeout control button: pauses for 10 seconds -->
  <div class="timeout-button">
    <button onclick="startTimeout()">Timeout 10s</button>
  </div>

  <!-- Core control buttons for scoring and timer -->
  <div id="buttonsWrapper" class="buttons" style="display: flex;">
    <button onclick="score('home')">Player 1</button> <!-- Score point for Home -->
    <button onclick="toggleTimer()">‚èØ</button>   <!-- Start/Pause timer -->
    <button onclick="score('away')">Player 2</button> <!-- Score point for Away -->
  </div>

  <!-- Settings (gear) icon to open config panel -->
  <div id="gear" onclick="toggleMenu()">‚öôÔ∏è</div>
  <div id="versionTag">ver-1.4 (‚ò†Ô∏è‚≠ê)</div>

  <!-- Settings panel that appears when gear icon is clicked -->
  <div id="menu">

    <!-- Checkbox to lock scoreboard to top of screen -->
    <label style="display: block; margin: 15px 0;">
      <input type="checkbox" id="lockToggle" onchange="toggleLock(this)" />
      Lock scoreboard to top
    </label>

    <label style="display: block; margin-top: 15px;">
  <input type="checkbox" id="soundToggle" checked onchange="toggleSound()" />
  Enable Sounds
</label>

    <!-- Layout toggle button -->
<!--<button onclick="switchToPortrait()">Switch to Portrait Mode</button>-->
  <!-- REMOVED PORTRAIT MODE BUTTON FOR LATER RELEASES--> 
    
    <!-- Back gear in menu -->
<div id="gearBack" onclick="toggleMenu()" style="font-size: 2.5em; cursor: pointer; margin-bottom: 10px;">‚öôÔ∏è</div>
    
    
    <!-- Input fields for updating team/player names -->
    <div class="name-container">
      <input type="text" id="homeName" class="name-input" placeholder="Player 1" />
      <input type="text" id="awayName" class="name-input" placeholder="Player 2" />
    </div>

    <button class="menu-action" onclick="saveNames()">Update Names</button>
    
<!-- Score Correction -->
<h3>Adjust Scores</h3>
<div class="time-controls" style="justify-content: space-between;">
  <div style="display: flex; gap: 10px;">
    <button onclick="adjustScore('home', 1)">+1</button>
    <button onclick="adjustScore('home', -1)">‚Äì1</button>
  </div>
  <div style="display: flex; gap: 10px;">
    <button onclick="adjustScore('away', 1)">+1</button>
    <button onclick="adjustScore('away', -1)">‚Äì1</button>
  </div>
</div>

<!-- Game Count Correction -->
<h3>Adjust Game Wins</h3>
<div class="time-controls" style="justify-content: space-between;">
  <div style="display: flex; gap: 10px;">
    <button onclick="adjustGames('home', 1)">+1</button>
    <button onclick="adjustGames('home', -1)">‚Äì1</button>
  </div>
  <div style="display: flex; gap: 10px;">
    <button onclick="adjustGames('away', 1)">+1</button>
    <button onclick="adjustGames('away', -1)">‚Äì1</button>
  </div>
</div>
    
    <!-- Action buttons for match control -->

<button class="menu-action" onclick="restartGame()">Restart Game</button>
<button class="menu-action" onclick="startSuddenDeath()">Force Sudden Death</button>
<button class="menu-action" onclick="swapSides()">Swap Sides</button>
<button class="menu-action" onclick="resetMatch()">Reset Match</button>

    <!-- Elegant Time Adjustment Controls -->
<div style="margin-top: 30px; padding: 15px; border: 2px solid #00ffff50; border-radius: 12px; background: rgba(0,255,255,0.05);">
  <h3 style="margin-bottom: 10px; color: #00ffff;">Adjust Match Timer</h3>
  
  <div class="time-controls">
    <strong>Add Time</strong>
  </div>
  <div class="time-controls">
    <button onclick="adjustTime(0.5)">+0.5s</button>
    <button onclick="adjustTime(1)">+1s</button>
    <button onclick="adjustTime(10)">+10s</button>
    <button onclick="adjustTime(30)">+30s</button>
    <button onclick="adjustTime(60)">+1min</button>
  </div>

  <div class="time-controls">
    <strong>Remove Time</strong>
  </div>
  <div class="time-controls">
    <button onclick="adjustTime(-0.5)">-0.5s</button>
    <button onclick="adjustTime(-1)">-1s</button>
    <button onclick="adjustTime(-10)">-10s</button>
    <button onclick="adjustTime(-30)">-30s</button>
    <button onclick="adjustTime(-60)">-1min</button>
  </div>
</div>

    <!-- Dynamic summary of match results -->
    <div class="match-summary" id="matchSummary">
      <h3>Match Summary</h3>
      <div id="summaryText"></div>
    </div>
  </div>

  <!-- Set horn sound --> 
    <audio id="hornSound" src="horn.mp3" preload="auto"></audio>
  
  <script>
    
  // Set the initial time to 3 minutes (in tenths of seconds)
  let time = 1800;

  // Declare timers and game state variables
  let timerInterval;
  let running = false;
  let homeScoreValue = 0;
  let awayScoreValue = 0;
  let blitz = false; // Blitz mode triggers at 1:00
  let suddenDeath = false;
  let homeGamesWon = 0;
  let awayGamesWon = 0;
  let matchesPlayed = 0;
  let timeoutCounter = 10;
  let timeoutInterval;
  let playPuckAnnounced = false;
  let timeoutActive = false;
  let lastGameWasSuddenDeath = false;
  let suddenDeathLoser = null;

  // Predefined times in seconds to call out remaining time
  const calloutTimes = new Set([150, 120, 90, 70, 60, 45, 30, 15, 10, 5, 4, 3]);
  let announcedTimes = new Set(); // Keeps track of times already announced
  let gameScores = []; // Stores completed game results

  // Speaks the given text aloud using browser's speech synthesis
  function speak(text) {
    if ('speechSynthesis' in window) {
      const msg = new SpeechSynthesisUtterance(text);
      msg.pitch = 1.2;
      msg.rate = 1.1;
      msg.volume = 1;
      speechSynthesis.speak(msg);
    }
  }

  // Add dedicated click listeners for score elements
  document.getElementById('homeScoreDisplay').addEventListener('click', (e) => {
    e.stopPropagation(); // prevent it from triggering scoreboard click
    score('home');
  });

  document.getElementById('awayScoreDisplay').addEventListener('click', (e) => {
    e.stopPropagation();
    score('away');
  });

  // Updates the visible timer and manages game flow at key time events
  function updateTimer() {
  const timerEl = document.getElementById('timer');
  timerEl.classList.remove('timer-small');
  const minutes = String(Math.floor(time / 600));
  const seconds = String(Math.floor((time % 600) / 10)).padStart(2, '0');
  const tenths = String(time % 10);
  timerEl.textContent = `${minutes}:${seconds}.${tenths}`;

  // Trigger Blitz mode at exactly 1:00 remaining
  const blitzWrapper = document.getElementById('blitzWrapper');
  const logoWrapper = document.getElementById('logoWrapper');
  const blitzBanner = document.getElementById('blitzBanner');

  if (time <= 600 && !blitz) {
    blitz = true;
    blitzWrapper.classList.add('active');
    logoWrapper.classList.add('hidden');
    blitzBanner.style.display = 'block';
    speak("Blitz Blitz Blitz! Double Points!");
  } else if (time > 600 && !running && !blitz) {
    // Reset visuals if not in blitz and timer is above 1:00
    blitzWrapper.classList.remove('active');
    logoWrapper.classList.remove('hidden');
  }

  // Handle end-of-match logic
  if (time === 0) {
    clearInterval(timerInterval);
    running = false;
    if (homeScoreValue === awayScoreValue) {
      startSuddenDeath();
    } else {
      endGame();
    }
  }

  // Announce specific countdown moments
  const sec = Math.floor(time / 10);
  if (!announcedTimes.has(sec)) {
    if (sec === 70) speak("Ten seconds til Blitz!");
  else if (sec === 60) speak("One minute remaining");
  else if (sec === 45) speak("Forty-five seconds");
  else if (sec === 30) speak("Thirty seconds");
  else if (sec === 15) speak("Fifteen seconds");
  else if (sec === 10) speak("Ten seconds");
  else if (sec === 5) speak("Five");
  else if (sec === 4) speak("Four");
  else if (sec === 3) speak("Three");
  else if (sec === 120) speak("Two minutes remaining"); // ‚úÖ new override
  else if (calloutTimes.has(sec)) speak(${minutes}:${seconds});

  announcedTimes.add(sec);
}
}
    
  // Starts or pauses the timer
  function toggleTimer() {
  const timerEl = document.getElementById('timer');

  if (timeoutInterval) {
    clearInterval(timeoutInterval);
    timeoutInterval = null;
    updateTimer();
  }

  if (running) {
    clearInterval(timerInterval);
    timerEl.classList.remove('running'); // üü• Stopped = red
  } else {
    // ‚úÖ Only announce "Play Puck" once per game
    if (!playPuckAnnounced) {
      speak("Play Puck");
      playPuckAnnounced = true;
    }

    timerInterval = setInterval(() => {
      if (time > 0) {
        time--;
        updateTimer();
      }
    }, 100);
    timerEl.classList.add('running'); // üü© Running = green
  }

  running = !running;
}

  // Adjusts the timer by a number of seconds (+/-)
  function adjustTime(seconds) {
    time = Math.max(0, Math.min(5999, time + seconds * 10));
    updateTimer();
  }

  // Increments score for specified team (blitz gives double points)
  function score(side) {
  const timerEl = document.getElementById('timer');
  if (side === 'home') homeScoreValue += blitz ? 2 : 1;
  if (side === 'away') awayScoreValue += blitz ? 2 : 1;
  document.getElementById('homeScoreDisplay').textContent = homeScoreValue;
  document.getElementById('awayScoreDisplay').textContent = awayScoreValue;

  // If in sudden death, any score ends the game
  if (suddenDeath) {
    endGame();
  } else {
    clearInterval(timerInterval);
    running = false;
    timerEl.classList.remove('running'); // üü• Clear green when pausing on score
  }
}

  // Starts a 10-second timeout period
  function startTimeout() {
  if (timeoutActive) return; // üö´ Prevent multiple timeouts

  timeoutActive = true; // ‚úÖ Lock future triggers
  if (running) toggleTimer(); // ‚è∏ Pause the game if it's running

  timeoutCounter = 10;
  const timerEl = document.getElementById('timer');
  timerEl.textContent = `Timeout: 10`;
  timerEl.classList.add('timer-small');

  // Add a one-time listener to cancel timeout on tap
  const cancelTimeout = () => {
    if (timeoutActive) {
      clearInterval(timeoutInterval);
      timeoutInterval = null;
      timeoutActive = false;
      timerEl.classList.remove('timer-small');
      updateTimer();
    }
    timerEl.removeEventListener('click', cancelTimeout);
  };
  timerEl.addEventListener('click', cancelTimeout);

  timeoutInterval = setInterval(() => {
    timeoutCounter--;
    if (timeoutCounter > 0) {
      timerEl.textContent = `Timeout: ${timeoutCounter}`;
    } else {
      clearInterval(timeoutInterval);
      timeoutInterval = null;
      timeoutActive = false;
      timerEl.classList.remove('timer-small');
      updateTimer();
      toggleTimer(); // ‚ñ∂Ô∏è Resume the game
      timerEl.removeEventListener('click', cancelTimeout);
    }
  }, 1000);
}

  // Handles end-of-game logic and saves result
  function endGame() {
  let preSwapWinner = null;
  let preSwapLoser = null;

  if (suddenDeath) {
    lastGameWasSuddenDeath = true;
    if (homeScoreValue !== awayScoreValue) {
      suddenDeathLoser = homeScoreValue < awayScoreValue ? 'home' : 'away';
    } else {
      suddenDeathLoser = null;
    }
  } else {
    matchesPlayed++;
    lastGameWasSuddenDeath = false;
    suddenDeathLoser = null;
  }

  if (homeScoreValue > awayScoreValue) {
    homeGamesWon++;
    preSwapWinner = 'home';
    preSwapLoser = 'away';
  } else {
    awayGamesWon++;
    preSwapWinner = 'away';
    preSwapLoser = 'home';
  }

  playHorn();

  const homeName = document.getElementById('homeName').value || 'Player 1';
  const awayName = document.getElementById('awayName').value || 'Player 2';
  gameScores.push({
  homeName,
  awayName,
  homeScore: homeScoreValue,
  awayScore: awayScoreValue,
  wasSuddenDeath: lastGameWasSuddenDeath
});

  updateNameDisplays(preSwapWinner, preSwapLoser); // üü® use *before* swap
  swapSides();
  resetForNextGame(true);
  updateSummary();
}

  // Resets scoreboard for the next game
  function resetForNextGame(preserveSuddenDeath = false) {
  homeScoreValue = 0;
  awayScoreValue = 0;
  time = 1800;
  blitz = false;
  suddenDeath = false;
  announcedTimes.clear();
  timeoutActive = false;
  document.getElementById('blitzBanner').style.display = 'none';
  updateTimer();
  document.getElementById('homeScoreDisplay').textContent = 0;
  document.getElementById('awayScoreDisplay').textContent = 0;

  // Only reset these after the pip logic runs
  if (!preserveSuddenDeath) {
    lastGameWasSuddenDeath = false;
    suddenDeathLoser = null;
  }
}

  // Fully resets match data and stats
  function resetMatch() {
  homeGamesWon = 0;
  awayGamesWon = 0;
  matchesPlayed = 0;
  gameScores = [];
  announcedTimes.clear();
  playPuckAnnounced = false;
  restartGame(true);

  // ‚úÖ Ensure only the correct gear is shown
  document.getElementById('gear').style.display = 'none';
  document.getElementById('gearBack').style.display = 'block';

  // üßπ Clear compact summary
  document.getElementById('compactSummary').textContent = '';

    // ‚úÖ Reset pips too
  updateNameDisplays();
}

  // Fully resets game and scoreboard UI state
  function restartGame(keepMenuOpen = false) {
  const timerEl = document.getElementById('timer');
  timerEl.classList.remove('timer-small');
  
  homeScoreValue = 0;
  awayScoreValue = 0;
  time = 1800;
  blitz = false;
  suddenDeath = false;
  announcedTimes.clear();
  timeoutActive = false;
  playPuckAnnounced = false;
  document.getElementById('blitzBanner').style.display = 'none';
  updateTimer();
  document.getElementById('homeScoreDisplay').textContent = 0;
  document.getElementById('awayScoreDisplay').textContent = 0;
  clearInterval(timerInterval);
  
  if (!keepMenuOpen) {
    document.getElementById('menu').classList.remove('active');
    document.getElementById('buttonsWrapper').style.display = 'flex';
    document.getElementById('gear').style.display = 'block';
    document.querySelector('.timeout-button').style.display = 'block';
    document.getElementById('gearBack').style.display = 'none';
  }

  running = false;
  updateSummary();
}

  // Opens and closes gear menu
  function toggleMenu() {
  const menu = document.getElementById('menu');
  const buttonsWrapper = document.getElementById('buttonsWrapper');
  const gear = document.getElementById('gear');
  const timeoutBtn = document.querySelector('.timeout-button');
  const gearBack = document.getElementById('gearBack');
  const versionTag = document.getElementById('versionTag'); // üëà add this line

  const isActive = menu.classList.contains('active');
  menu.classList.toggle('active');
  buttonsWrapper.style.display = isActive ? 'flex' : 'none';
  gear.style.display = isActive ? 'block' : 'none';
  timeoutBtn.style.display = isActive ? 'block' : 'none';
  gearBack.style.display = isActive ? 'none' : 'block';
  versionTag.style.display = isActive ? 'block' : 'none'; // üëà this hides version when menu is open

  if (!isActive) {
    setTimeout(() => {
      document.getElementById('homeName').focus();
    }, 300);
  }
}

  // Puts game into sudden death mode (no timer, first score wins)
  function startSuddenDeath() {
  clearInterval(timerInterval);
  suddenDeath = true;
  lastGameWasSuddenDeath = false;
  running = false;
  time = 0;

  // üîÅ Auto-clear Blitz Mode
  blitz = false;
  document.getElementById('blitzBanner').style.display = 'none';

  const timerEl = document.getElementById('timer');
  timerEl.textContent = 'Sudden Death';
  timerEl.classList.add('timer-small'); // üëà Add this line
}

  function swapSides() {
  const scoreboard = document.querySelector('.scoreboard');
  scoreboard.classList.toggle('reverse');

  // Swap player names
  const homeInput = document.getElementById('homeName');
  const awayInput = document.getElementById('awayName');
  [homeInput.value, awayInput.value] = [awayInput.value, homeInput.value];

  // Swap scores
  [homeScoreValue, awayScoreValue] = [awayScoreValue, homeScoreValue];
  document.getElementById('homeScoreDisplay').textContent = homeScoreValue;
  document.getElementById('awayScoreDisplay').textContent = awayScoreValue;

  // Swap games won
  [homeGamesWon, awayGamesWon] = [awayGamesWon, homeGamesWon];

  // Update UI
  updateNameDisplays();
  updateSummary();
}

    function saveNames() {
  const homeName = document.getElementById('homeName').value;
  const awayName = document.getElementById('awayName').value;
  localStorage.setItem('homeName', homeName);
  localStorage.setItem('awayName', awayName);
  updateNameDisplays();
  updateSummary();
}
  // Updates name and score UI for each player
  function updateNameDisplays(preWinner = null, preLoser = null) {
  const reversed = document.querySelector('.scoreboard').classList.contains('reverse');

  const homeNameInput = document.getElementById('homeName').value || 'Player 1';
  const awayNameInput = document.getElementById('awayName').value || 'Player 2';

  const gamesTotal = homeGamesWon + awayGamesWon;

  const homeLost = lastGameWasSuddenDeath && preLoser === 'home';
  const awayLost = lastGameWasSuddenDeath && preLoser === 'away';

  const leftDisplay = document.getElementById('homeDisplay');
  const rightDisplay = document.getElementById('awayDisplay');

  if (gamesTotal > 0) {
    if (!reversed) {
      leftDisplay.textContent = `${homeNameInput} ${getPips(homeGamesWon, homeLost, gamesTotal)}`;
      rightDisplay.textContent = `${awayNameInput} ${getPips(awayGamesWon, awayLost, gamesTotal)}`;
    } else {
      leftDisplay.textContent = `${awayNameInput} ${getPips(awayGamesWon, awayLost, gamesTotal)}`;
      rightDisplay.textContent = `${homeNameInput} ${getPips(homeGamesWon, homeLost, gamesTotal)}`;
    }
  } else {
    if (!reversed) {
      leftDisplay.textContent = homeNameInput;
      rightDisplay.textContent = awayNameInput;
    } else {
      leftDisplay.textContent = awayNameInput;
      rightDisplay.textContent = homeNameInput;
    }
  }
}
  // Builds summary text for the match summary section
  function updateSummary() {
  const homeName = document.getElementById('homeName').value || 'Player 1';
  const awayName = document.getElementById('awayName').value || 'Player 2';
  let summary = '';

  if (homeGamesWon > awayGamesWon) {
    summary += `<span class='winner'>Home: ${homeName} (${homeGamesWon} Wins)</span><br>Away: ${awayName} (${awayGamesWon} Wins)<br>`;
  } else if (awayGamesWon > homeGamesWon) {
    summary += `Home: ${homeName} (${homeGamesWon} Wins)<br><span class='winner'>Away: ${awayName} (${awayGamesWon} Wins)</span><br>`;
  } else {
    summary += `Home: ${homeName} (${homeGamesWon} Wins)<br>Away: ${awayName} (${awayGamesWon} Wins)<br>`;
  }

  summary += `Matches Played: ${matchesPlayed}<br><br>`;

  if (gameScores.length > 0) {
    summary += `<strong>Game Scores:</strong><br>` +
      gameScores.map((s, i) =>
        `Game ${i + 1}: ${s.homeName} ${s.homeScore} ‚Äì ${s.awayScore} ${s.awayName}${s.wasSuddenDeath ? ' ‚Ä†' : ''}`
      ).join('<br>');
  }

  document.getElementById('summaryText').innerHTML = summary;
  updateCompactSummary();
}
    function updateCompactSummary() {
  const summaryDiv = document.getElementById('compactSummary');
  if (!gameScores.length) {
    summaryDiv.textContent = '';
    return;
  }

  const compact = gameScores.map((g, i) => {
    const isSuddenDeath = i === gameScores.length - 1 && g.wasSuddenDeath;
    const dagger = isSuddenDeath ? `<span class="suddendeath">‚Ä†</span>` : '';

    const homeInitial = g.homeName[0] || '?';
    const awayInitial = g.awayName[0] || '?';
    const homeScore = g.homeScore;
    const awayScore = g.awayScore;

    let winnerInitial, loserInitial, winnerScore, loserScore;

    if (homeScore > awayScore) {
      winnerInitial = homeInitial;
      loserInitial = awayInitial;
      winnerScore = homeScore;
      loserScore = awayScore;
    } else {
      winnerInitial = awayInitial;
      loserInitial = homeInitial;
      winnerScore = awayScore;
      loserScore = homeScore;
    }

    return `G${i + 1}${dagger} ${winnerInitial}${winnerScore}‚Äì${loserScore}${loserInitial}`;
  }).join(', ');

  summaryDiv.innerHTML = compact;
}
  // Loads saved player names from localStorage on page load
  function loadNames() {
    const savedHome = localStorage.getItem('homeName');
    const savedAway = localStorage.getItem('awayName');
    if (savedHome) document.getElementById('homeName').value = savedHome;
    if (savedAway) document.getElementById('awayName').value = savedAway;
    updateNameDisplays();
    updateSummary();
  }

  // Run initial load
  loadNames();
  updateTimer();

    document.querySelector('.scoreboard').addEventListener('click', (e) => {
  const logo = document.getElementById('mainLogo');
  if (logo && logo.contains(e.target)) {
    startTimeout();
    return;
  }

  if (e.target.id === 'homeScoreDisplay') {
    score('home');
    return;
  }

  if (e.target.id === 'awayScoreDisplay') {
    score('away');
    return;
  }

  if (e.target.id === 'timer') {
    toggleTimer();
    return;
  }
});
    document.getElementById('timer').addEventListener('click', (e) => {
  e.stopPropagation(); // prevent scoreboard click fallback
  toggleTimer();       // toggle the match timer
});
  // Toggles the "locked" class on body to fix scoreboard at top
  function toggleLock(checkbox) {
    const scoreboard = document.querySelector('.scoreboard');
    if (checkbox.checked) {
      document.body.classList.add('locked');
    } else {
      document.body.classList.remove('locked');
    }
  }
    function adjustScore(side, delta) {
  if (side === 'home') {
    homeScoreValue = Math.max(0, homeScoreValue + delta);
    document.getElementById('homeScoreDisplay').textContent = homeScoreValue;
  } else {
    awayScoreValue = Math.max(0, awayScoreValue + delta);
    document.getElementById('awayScoreDisplay').textContent = awayScoreValue;
  }
}

function adjustGames(side, delta) {
  if (side === 'home') {
    homeGamesWon = Math.max(0, homeGamesWon + delta);
  } else {
    awayGamesWon = Math.max(0, awayGamesWon + delta);
  }
  updateNameDisplays();
  updateSummary();
}
    // play horn sound at the end of the match
    let soundEnabled = true;

function playHorn() {
  if (soundEnabled) {
    const horn = document.getElementById('hornSound');
    horn.currentTime = 0;
    setTimeout(() => {
      horn.play().catch((e) => {
        console.warn("Horn playback failed:", e);
      });
    }, 0);
  }
}
    // Toggles sound on/off 
    function toggleSound() {
  soundEnabled = document.getElementById('soundToggle').checked;
}
    function switchToPortrait() {
  // Optional: confirm switch
  if (confirm("Switch to Portrait (One-Hand) Mode? Switching layout will reset all game data. Continue?")) {
    window.location.href = "PMindex.html";
  }
}
    function isMobile() {
    return /Mobi|Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
  }

  function checkOrientation() {
    const prompt = document.getElementById('rotatePrompt');
    if (isMobile() && window.innerHeight > window.innerWidth) {
      prompt.style.display = 'flex';
    } else {
      prompt.style.display = 'none';
    }
  }

  window.addEventListener("orientationchange", checkOrientation);
  window.addEventListener("resize", checkOrientation);
  window.addEventListener("load", checkOrientation);

function getPips(wins, isLoser = false, totalGames = 0) {
  const total = Math.max(totalGames, wins);
  const pipCount = Math.min(total, 7); // cap at 7 for layout safety
  let pips = '';

  // Handle sudden death win (last game was SD and this player didn't lose)
  const isWinnerInSuddenDeath = lastGameWasSuddenDeath && !isLoser;

  for (let i = 0; i < wins; i++) {
    if (isWinnerInSuddenDeath && i === wins - 1) {
      pips += '‚≠ê'; // last pip is gold for SD win
    } else {
      pips += '‚óè';
    }
  }

  const emptySlots = pipCount - wins;

  if (isLoser && emptySlots > 0) {
    pips += '‚ò†Ô∏è' + '‚óã'.repeat(emptySlots - 1);
  } else {
    pips += '‚óã'.repeat(emptySlots);
  }

  return pips;
}
    
</script>
</body>
</html>
